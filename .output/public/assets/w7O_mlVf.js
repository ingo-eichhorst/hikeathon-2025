import{y as Z,b as i,w as Q,k as $,a1 as X,O as l,U as t,Z as g,W as q,V as r,Y as y,a5 as ee,$ as k,a0 as _,a6 as te,a2 as se,F,_ as A,z as S,H as o}from"./lyzmDKnL.js";import{u as ae}from"#entry";import{u as le}from"./8cy__C5Z.js";import{u as oe}from"./BJ9MKNdY.js";import"./wtOtceyD.js";import"./BQPXNKIG.js";const re={class:"space-y-6"},ne={class:"card"},de={key:0,class:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},ue={class:"space-y-1 text-sm"},ie={class:"flex items-center gap-2"},ce={class:"flex gap-2"},ge=["disabled"],ve=["disabled"],be=["disabled"],me={class:"card"},ye={class:"space-y-4"},pe=["disabled"],xe={class:"card"},fe={key:0,class:"text-gray-500"},we={key:1,class:"space-y-2"},ke={class:"font-medium"},he={class:"ml-2 text-sm text-gray-500"},Ce={class:"flex items-center gap-2"},_e={class:"text-xs text-gray-500"},Se={class:"card"},Te={class:"space-y-4"},De={class:"flex items-center gap-2"},Be={class:"capitalize"},Me={key:0,class:"text-sm text-yellow-600 dark:text-yellow-400"},Fe={class:"mt-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg"},Ae={class:"flex gap-2"},Ue=["disabled"],Ve={class:"mt-4"},Ie={key:0,class:"text-sm text-gray-500"},Ne={key:1,class:"space-y-1"},$e={class:"card"},qe={key:0,class:"text-gray-500"},Ee={key:1,class:"space-y-2"},Re={class:"flex items-start justify-between"},Le={class:"flex-1"},Oe={class:"mt-1 flex items-center gap-2 text-xs text-gray-500"},ze={key:0},Ye=Z({__name:"admin",setup(He){const{$supabase:p}=ae(),{sendBroadcast:U,broadcasts:T,presence:E,connectionState:C,isSupabaseAvailable:D}=le(),x=i(""),B=i("info"),h=i(!1),v=i(null),n=i(null),c=i(!1),d=i(null),u=i({title:"",deadline:"",active:!0}),b=i(""),m=i(null),f=i([]);Q(T,s=>{const e=s[0];e&&e.from==="test"&&(f.value.unshift(`${e.message} (${new Date(e.timestamp).toLocaleTimeString()})`),f.value.length>5&&(f.value=f.value.slice(0,5)))});const V=$(()=>Array.from(E.value.values())),I=$(()=>T.value.slice(0,10)),R=async()=>{if(b.value.trim()){m.value=null;try{console.log("Sending test broadcast:",b.value),console.log("Connection state:",C.value),console.log("Supabase available:",D.value),await U(b.value,"info","test"),console.log("Broadcast sent, current broadcasts:",T.value),m.value={success:!0,message:`✓ Test broadcast sent successfully! Connection: ${C.value}`},b.value="",setTimeout(()=>{m.value=null},3e3)}catch(s){console.error("Test broadcast error:",s),m.value={success:!1,message:`✗ Failed: ${s instanceof Error?s.message:"Unknown error"}`}}}},L=async()=>{if(!(!x.value.trim()||h.value)){h.value=!0,v.value=null;try{await U(x.value,B.value,"Admin"),v.value={type:"success",message:"Broadcast sent and saved to database successfully!"},x.value="",setTimeout(()=>{v.value=null},3e3)}catch(s){console.error("Error sending broadcast:",s),v.value={type:"error",message:"Failed to send broadcast"}}finally{h.value=!1}}},N=s=>{switch(s){case"success":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"}},O=s=>{switch(s){case"success":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"warning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"}},z=s=>s==="idle"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",H=s=>{switch(s){case"connected":return"bg-green-500 animate-pulse";case"connecting":return"bg-yellow-500 animate-pulse";default:return"bg-red-500"}},j=s=>new Date(s).toLocaleTimeString(),P=s=>{const e=new Date(s),w=new Date().getTime()-e.getTime();return w<6e4?"Just now":w<36e5?`${Math.floor(w/6e4)}m ago`:`${Math.floor(w/36e5)}h ago`},W=s=>new Date(s).toLocaleString("en-US",{dateStyle:"full",timeStyle:"short"}),M=async()=>{try{const{data:s,error:e}=await p.from("countdowns").select("*").eq("active",!0).order("created_at",{ascending:!1}).limit(1).single();if(e&&e.code!=="PGRST116")throw e;s&&(n.value=s,u.value={title:s.title,deadline:new Date(s.deadline).toISOString().slice(0,16),active:s.active})}catch(s){console.error("Failed to load countdown:",s)}},G=async()=>{c.value=!0,d.value=null;try{const s={title:u.value.title,deadline:new Date(u.value.deadline).toISOString(),active:u.value.active};if(n.value){const{error:e}=await p.from("countdowns").update(s).eq("id",n.value.id);if(e)throw e;d.value={type:"success",text:"Countdown updated successfully!"}}else{await p.from("countdowns").update({active:!1}).eq("active",!0);const{error:e}=await p.from("countdowns").insert([s]);if(e)throw e;d.value={type:"success",text:"Countdown created successfully!"}}await M(),setTimeout(()=>{d.value=null},3e3)}catch(s){console.error("Failed to save countdown:",s),d.value={type:"error",text:s.message||"Failed to save countdown"}}finally{c.value=!1}},J=async()=>{if(n.value){c.value=!0,d.value=null;try{const{error:s}=await p.from("countdowns").update({active:!1}).eq("id",n.value.id);if(s)throw s;d.value={type:"success",text:"Countdown deactivated successfully!"},await M()}catch(s){console.error("Failed to deactivate countdown:",s),d.value={type:"error",text:s.message||"Failed to deactivate countdown"}}finally{c.value=!1}}},K=async()=>{if(n.value&&confirm("Are you sure you want to delete this countdown?")){c.value=!0,d.value=null;try{const{error:s}=await p.from("countdowns").delete().eq("id",n.value.id);if(s)throw s;d.value={type:"success",text:"Countdown deleted successfully!"},n.value=null,u.value={title:"",deadline:"",active:!0}}catch(s){console.error("Failed to delete countdown:",s),d.value={type:"error",text:s.message||"Failed to delete countdown"}}finally{c.value=!1}}};return X(()=>{M()}),oe({title:"Admin - HIKEathon 2025"}),(s,e)=>(o(),l("div",re,[e[25]||(e[25]=t("h1",{class:"text-3xl font-bold"},"Admin Panel",-1)),t("div",ne,[e[14]||(e[14]=t("h2",{class:"text-xl font-semibold mb-4"},"Countdown Management",-1)),n.value?(o(),l("div",de,[e[9]||(e[9]=t("h3",{class:"font-semibold mb-2"},"Current Active Countdown",-1)),t("div",ue,[t("p",null,[e[6]||(e[6]=t("strong",null,"Title:",-1)),q(" "+r(n.value.title),1)]),t("p",null,[e[7]||(e[7]=t("strong",null,"Deadline:",-1)),q(" "+r(W(n.value.deadline)),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Status:",-1)),t("span",{class:y(["px-2 py-1 rounded text-xs",n.value.active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"])},r(n.value.active?"Active":"Inactive"),3)])])])):g("",!0),t("form",{onSubmit:ee(G,["prevent"]),class:"space-y-4"},[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium mb-2"}," Title / Deadline Text ",-1)),k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.title=a),type:"text",placeholder:"e.g., Submission Deadline, Event Starts In...",required:"",class:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},null,512),[[_,u.value.title]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium mb-2"}," Deadline Date & Time ",-1)),k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.deadline=a),type:"datetime-local",required:"",class:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},null,512),[[_,u.value.deadline]]),e[12]||(e[12]=t("p",{class:"text-xs text-gray-500 mt-1"}," Countdown will be visible until 5 minutes after this deadline ",-1))]),t("div",ie,[k(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.active=a),type:"checkbox",id:"countdown-active-checkbox",class:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"},null,512),[[te,u.value.active]]),e[13]||(e[13]=t("label",{for:"countdown-active-checkbox",class:"text-sm font-medium"}," Active (visible to users) ",-1))]),t("div",ce,[t("button",{type:"submit",disabled:c.value,class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-50 text-sm"},r(c.value?"Saving...":n.value?"Update":"Create"),9,ge),n.value?(o(),l("button",{key:0,type:"button",onClick:J,disabled:c.value,class:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg disabled:opacity-50 text-sm"}," Deactivate ",8,ve)):g("",!0),n.value?(o(),l("button",{key:1,type:"button",onClick:K,disabled:c.value,class:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg disabled:opacity-50 text-sm"}," Delete ",8,be)):g("",!0)]),d.value?(o(),l("div",{key:0,class:y(["p-3 rounded-lg text-sm",N(d.value.type)])},r(d.value.text),3)):g("",!0)],32)]),t("div",me,[e[18]||(e[18]=t("h2",{class:"text-xl font-semibold mb-4"},"Send Broadcast",-1)),t("div",ye,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-2"},"Message",-1)),k(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>x.value=a),rows:"3",placeholder:"Enter broadcast message...",class:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},null,512),[[_,x.value]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-2"},"Type",-1)),k(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>B.value=a),class:"px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},[...e[16]||(e[16]=[t("option",{value:"info"},"Info",-1),t("option",{value:"success"},"Success",-1),t("option",{value:"warning"},"Warning",-1),t("option",{value:"error"},"Error",-1)])],512),[[se,B.value]])]),t("button",{onClick:L,disabled:!x.value.trim()||h.value,"data-testid":"send-broadcast",class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-50"},r(h.value?"Sending...":"Send Broadcast"),9,pe),v.value?(o(),l("div",{key:0,class:y(["p-3 rounded-lg",N(v.value.type)])},r(v.value.message),3)):g("",!0)])]),t("div",xe,[e[19]||(e[19]=t("h2",{class:"text-xl font-semibold mb-4"},"Active Teams",-1)),V.value.length===0?(o(),l("div",fe," No teams currently online ")):(o(),l("div",we,[(o(!0),l(F,null,A(V.value,a=>(o(),l("div",{key:a.teamId,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[t("div",null,[t("span",ke,r(a.teamName),1),t("span",he," (ID: "+r(a.teamId)+") ",1)]),t("div",Ce,[t("span",{class:y(["text-xs px-2 py-1 rounded-full",z(a.status)])},r(a.status||"active"),3),t("span",_e,r(P(a.onlineAt)),1)])]))),128))]))]),t("div",Se,[e[23]||(e[23]=t("h2",{class:"text-xl font-semibold mb-4"},"Connection Status & Broadcast Tester",-1)),t("div",Te,[t("div",De,[t("div",{class:y(["w-3 h-3 rounded-full",H(S(C))])},null,2),t("span",Be,r(S(C)),1),S(D)?g("",!0):(o(),l("span",Me," (Realtime unavailable) "))]),t("div",Fe,[e[20]||(e[20]=t("h3",{class:"font-medium mb-2"},"Test Broadcast Channel",-1)),e[21]||(e[21]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-3"}," Send a test message to verify broadcast functionality ",-1)),t("div",Ae,[k(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>b.value=a),type:"text",placeholder:"Test message...",class:"flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},null,512),[[_,b.value]]),t("button",{onClick:R,disabled:!b.value.trim()||!S(D),class:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg disabled:opacity-50"}," Test ",8,Ue)]),m.value?(o(),l("div",{key:0,class:y(["mt-3 p-2 rounded text-sm",m.value.success?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200"])},r(m.value.message),3)):g("",!0)]),t("div",Ve,[e[22]||(e[22]=t("h3",{class:"font-medium mb-2"},"Received Test Messages",-1)),f.value.length===0?(o(),l("div",Ie," No test messages received yet ")):(o(),l("div",Ne,[(o(!0),l(F,null,A(f.value,(a,w)=>(o(),l("div",{key:w,class:"text-sm p-2 bg-blue-50 dark:bg-blue-900 rounded"},r(a),1))),128))]))])])]),t("div",$e,[e[24]||(e[24]=t("h2",{class:"text-xl font-semibold mb-4"},"Recent Broadcasts",-1)),I.value.length===0?(o(),l("div",qe," No broadcasts sent yet ")):(o(),l("div",Ee,[(o(!0),l(F,null,A(I.value,a=>(o(),l("div",{key:a.id,class:"p-3 rounded-lg border border-gray-200 dark:border-gray-700"},[t("div",Re,[t("div",Le,[t("p",null,r(a.message),1),t("div",Oe,[a.from?(o(),l("span",ze,"From: "+r(a.from),1)):g("",!0),t("span",null,r(j(a.timestamp)),1),t("span",{class:y(["px-2 py-0.5 rounded-full text-xs",O(a.type)])},r(a.type),3)])])])]))),128))]))])]))}});export{Ye as default};
