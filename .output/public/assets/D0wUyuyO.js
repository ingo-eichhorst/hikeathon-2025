import{y as F,b as k,X as O,O as d,H as i,Y as z,U as t,Z as _,F as D,_ as P,$ as U,a0 as V,V as I,J as C,z as g,G as R,k as G,a1 as W,w as H,a2 as K,a3 as X,a4 as Y,a5 as Z}from"./lyzmDKnL.js";import{d as B}from"./Bx3Ta1aT.js";import{u as J}from"./r888hXRh.js";import{u as q}from"./8cy__C5Z.js";import{u as Q}from"./BJ9MKNdY.js";import"#entry";import"./wtOtceyD.js";import"./BQPXNKIG.js";const ee=["data-testid"],te={key:0,class:"space-y-3"},se=["innerHTML"],ae={key:0},ne={class:"grid grid-cols-2 gap-2 sm:grid-cols-3"},oe=["src","alt","onClick"],le={key:1,class:"space-y-2"},ie={key:2,class:"mt-2"},re={key:3,class:"mt-2 flex gap-2 text-xs opacity-60"},de={class:"max-w-4xl max-h-[90vh] bg-white dark:bg-gray-900 rounded-lg overflow-auto"},ce={class:"flex justify-between items-center p-4 border-b border-gray-300 dark:border-gray-700"},ge={class:"text-lg font-semibold"},ue={class:"p-4"},me=["src","alt"],ve=F({__name:"ChatMessage",props:{message:{}},emits:["edit","delete","regenerate"],setup(u,{emit:s}){const m=u,f=s,v=k(!1),b=k(""),h=k(!1),c=k(null),w=n=>{c.value=n,h.value=!0};B.setOptions({breaks:!0,gfm:!0}),B.use({renderer:{codespan(n){return`<code>${n.text}</code>`}}});const $=n=>{try{if(!n)return console.log("Empty content for message:",m.message.id,m.message.role),"";const a=B(n);return typeof a=="string"?a:n}catch(a){return console.error("Markdown render error:",a),n}},A=()=>{f("edit",m.message.id,b.value),v.value=!1},M=()=>{v.value=!1,b.value=""};return(n,a)=>{const o=O("Icon");return i(),d("div",{class:z(["flex gap-3",u.message.role==="user"?"justify-end":"justify-start"]),"data-testid":`${u.message.role}-message`},[t("div",{class:z(["max-w-[80%] rounded-lg p-4",u.message.role==="user"?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100"])},[v.value?(i(),d("div",le,[U(t("textarea",{"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e),class:"w-full p-2 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",rows:"3"},null,512),[[V,b.value]]),t("div",{class:"flex gap-2"},[t("button",{onClick:A,class:"px-2 py-1 bg-green-600 text-white rounded text-sm"}," Save "),t("button",{onClick:M,class:"px-2 py-1 bg-gray-600 text-white rounded text-sm"}," Cancel ")])])):(i(),d("div",te,[t("div",{class:"prose prose-sm dark:prose-invert max-w-none",innerHTML:$(u.message.content||"")},null,8,se),u.message.attachments&&u.message.attachments.length>0?(i(),d("div",ae,[t("div",ne,[(i(!0),d(D,null,P(u.message.attachments.filter(e=>e.type==="image"),e=>(i(),d("div",{key:e.id,class:"rounded-lg overflow-hidden bg-gray-200 dark:bg-gray-700"},[t("img",{src:e.content,alt:e.name,class:"w-full h-auto max-h-48 object-cover cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>w(e)},null,8,oe)]))),128))])])):_("",!0)])),u.message.isStreaming?(i(),d("div",ie,[...a[6]||(a[6]=[t("span",{class:"inline-block w-2 h-2 bg-current rounded-full animate-pulse"},null,-1)])])):_("",!0),v.value?_("",!0):(i(),d("div",re,[t("button",{onClick:a[1]||(a[1]=e=>v.value=!0),class:"hover:opacity-100"},"Edit"),t("button",{onClick:a[2]||(a[2]=e=>n.$emit("delete")),class:"hover:opacity-100"},"Delete"),u.message.role==="assistant"?(i(),d("button",{key:0,onClick:a[3]||(a[3]=e=>n.$emit("regenerate")),class:"hover:opacity-100"}," Regenerate ")):_("",!0)]))],2),h.value&&c.value?(i(),d("div",{key:0,class:"fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4",onClick:a[5]||(a[5]=e=>h.value=!1)},[t("div",de,[t("div",ce,[t("h3",ge,I(c.value.name),1),t("button",{onClick:a[4]||(a[4]=e=>h.value=!1),class:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"},[C(o,{icon:"mdi:close",class:"w-6 h-6"})])]),t("div",ue,[t("img",{src:c.value.content,alt:c.value.name,class:"w-full h-auto"},null,8,me)])])])):_("",!0)],10,ee)}}}),pe={key:0,class:"space-y-2 mb-3"},ye={class:"text-sm text-gray-600 dark:text-gray-400 flex items-center gap-2"},fe={class:"grid grid-cols-4 gap-2 sm:grid-cols-6"},he=["src","alt"],be={class:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},xe={class:"text-white text-xs text-center"},ke={class:"text-xs"},we=["onClick"],_e=F({__name:"ImagePreview",props:{images:{}},emits:["remove"],setup(u,{emit:s}){const m=s,f=v=>{if(v===0)return"0 Bytes";const b=1024,h=["Bytes","KB","MB"],c=Math.floor(Math.log(v)/Math.log(b));return Math.round(v/Math.pow(b,c)*100)/100+" "+h[c]};return(v,b)=>{const h=O("Icon");return u.images.length>0?(i(),d("div",pe,[t("div",ye,[C(h,{icon:"mdi:image-check",class:"w-4 h-4"}),t("span",null,I(u.images.length)+" image"+I(u.images.length!==1?"s":"")+" attached",1),b[0]||(b[0]=t("span",{class:"text-xs text-blue-600 dark:text-blue-400"},"(using Mistral Small 24B)",-1))]),t("div",fe,[(i(!0),d(D,null,P(u.images,c=>(i(),d("div",{key:c.id,class:"relative group rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700"},[t("img",{src:`data:${c.type};base64,${c.base64}`,alt:c.name,class:"w-full h-20 object-cover"},null,8,he),t("div",be,[t("div",xe,[t("div",null,I(c.width)+"x"+I(c.height),1),t("div",ke,I(f(c.size)),1)])]),t("button",{onClick:w=>m("remove",c.id),class:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",title:"Remove image"},[C(h,{icon:"mdi:close",class:"w-3 h-3"})],8,we)]))),128))])])):_("",!0)}}}),S={MAX_FILE_SIZE:5*1024*1024,ALLOWED_TYPES:["image/jpeg","image/png","image/webp","image/gif"],VISION_MODEL:"mistral-small-24b"},j=()=>{const u=k([]),s=k(!1),m=k(null),f=n=>S.ALLOWED_TYPES.includes(n.type)?n.size>S.MAX_FILE_SIZE?{valid:!1,error:`File size exceeds ${S.MAX_FILE_SIZE/1024/1024}MB limit`}:{valid:!0}:{valid:!1,error:`Invalid file type. Allowed types: ${S.ALLOWED_TYPES.join(", ")}`},v=n=>new Promise((a,o)=>{const e=new FileReader;e.onload=()=>{const l=e.result.split(",")[1]||"";a(l)},e.onerror=o,e.readAsDataURL(n)}),b=n=>new Promise((a,o)=>{const e=new FileReader;e.onload=l=>{const p=new Image;p.onload=()=>{a({width:p.width,height:p.height})},p.onerror=o,p.src=l.target?.result},e.onerror=o,e.readAsDataURL(n)}),h=async n=>{m.value=null,s.value=!0;try{const a=f(n);if(!a.valid)return m.value=a.error||"Invalid image",!1;const o=await v(n),{width:e,height:l}=await b(n),p={id:crypto.randomUUID(),name:n.name,size:n.size,type:n.type,base64:o,timestamp:Date.now(),width:e,height:l};return u.value.push(p),!0}catch(a){return m.value=a instanceof Error?a.message:"Failed to upload image",!1}finally{s.value=!1}};return{images:u,isLoading:s,error:m,addImage:h,removeImage:n=>{u.value=u.value.filter(a=>a.id!==n)},clearImages:()=>{u.value=[],m.value=null},handleFileInput:async n=>{const a=n.target,o=a.files;if(o){for(let e=0;e<o.length;e++)await h(o[e]);a.value=""}},handlePaste:async n=>{const a=n.clipboardData?.items;if(a)for(let o=0;o<a.length;o++){const e=a[o];if(e.kind==="file"&&e.type.startsWith("image/")){const l=e.getAsFile();l&&(n.preventDefault(),await h(l))}}},isMobile:()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),validateImage:f}},Ie={class:"relative"},Me=["disabled"],$e={class:"w-full bg-white dark:bg-gray-800 rounded-t-lg shadow-lg"},Ce={class:"p-4"},Ee={class:"space-y-2"},Ae=F({__name:"ImageUploadButton",emits:["imageAdded","error"],setup(u,{emit:s}){const m=s,{addImage:f,isMobile:v,isLoading:b}=j(),h=k(),c=k(),w=k(!1),$=()=>{v()?w.value=!0:c.value?.click()},A=async o=>{const e=o.target,l=e.files;if(l){for(let p=0;p<l.length;p++)await f(l[p])&&m("imageAdded",l[p]);e.value=""}},M=async o=>{const e=o.clipboardData?.items;if(e)for(let l=0;l<e.length;l++){const p=e[l];if(p.kind==="file"&&p.type.startsWith("image/")){const L=p.getAsFile();L&&(o.preventDefault(),await f(L)&&m("imageAdded",L))}}},n=()=>{w.value=!1;const o=document.createElement("input");o.type="file",o.accept="image/*",o.capture="environment",o.onchange=async e=>{const l=e.target.files;l&&await f(l[0])&&m("imageAdded",l[0])},o.click()},a=()=>{w.value=!1;const o=document.createElement("input");o.type="file",o.accept="image/*",o.onchange=async e=>{const l=e.target.files;l&&await f(l[0])&&m("imageAdded",l[0])},o.click()};return(o,e)=>{const l=O("Icon");return i(),d("div",Ie,[t("button",{onClick:$,disabled:g(b),title:"Upload image for AI analysis",class:"inline-flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[g(b)?(i(),R(l,{key:1,icon:"mdi:loading",class:"w-5 h-5 text-gray-600 dark:text-gray-300 animate-spin"})):(i(),R(l,{key:0,icon:"mdi:image-plus",class:"w-5 h-5 text-gray-600 dark:text-gray-300"}))],8,Me),t("input",{ref_key:"fileInput",ref:h,type:"file",multiple:"",accept:"image/*",class:"hidden",onChange:A,onPaste:M},null,544),w.value?(i(),d("div",{key:0,class:"fixed inset-0 z-50 flex items-end",onClick:e[1]||(e[1]=p=>w.value=!1)},[t("div",$e,[t("div",Ce,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold mb-4"},"Upload Image",-1)),t("div",Ee,[t("button",{onClick:n,class:"w-full px-4 py-3 text-left rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3"},[C(l,{icon:"mdi:camera",class:"w-5 h-5"}),e[2]||(e[2]=t("span",null,"Take Photo",-1))]),t("button",{onClick:a,class:"w-full px-4 py-3 text-left rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-3"},[C(l,{icon:"mdi:image",class:"w-5 h-5"}),e[3]||(e[3]=t("span",null,"Photo Library",-1))]),t("button",{onClick:e[0]||(e[0]=p=>w.value=!1),class:"w-full px-4 py-3 text-center text-red-500 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700"}," Cancel ")])])])])):_("",!0),g(v)()?_("",!0):(i(),d("input",{key:1,ref_key:"desktopFileInput",ref:c,type:"file",multiple:"",accept:"image/*",class:"hidden",onChange:A},null,544))])}}}),Le={class:"h-full flex flex-col"},Se={key:0,class:"p-3 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 text-sm text-center"},De={class:"p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},Pe={class:"flex items-center justify-between"},Fe={class:"flex items-center gap-4"},Te=["disabled"],Be={key:0,disabled:""},Ue={key:1,disabled:""},Oe=["value"],ze={class:"text-sm text-gray-600 dark:text-gray-400"},Re={class:"flex-1 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-900"},Ve={key:0,class:"flex items-center gap-2 text-gray-600 dark:text-gray-400 mb-2"},je={class:"text-sm"},Ne={key:1,class:"flex items-center gap-2 text-gray-600 dark:text-gray-400"},Ge={class:"p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},We={class:"flex gap-2"},He=["onKeydown","disabled"],Ke={class:"flex flex-col gap-2"},Xe=["disabled"],nt=F({__name:"chat",setup(u){const s=J(),m=k(s.currentModel),f=k(""),{images:v,removeImage:b,handlePaste:h}=j(),c=q(),{typingUsers:w,sendTypingIndicator:$,isSupabaseAvailable:A}=c,M=k(null),n=G(()=>Array.from(w.value.values()).filter(y=>y.isTyping).map(y=>y.teamName));W(async()=>{await s.fetchAvailableModels(),m.value=s.currentModel}),H(()=>s.currentModel,y=>{m.value=y});const a=()=>{M.value&&clearTimeout(M.value),$(!0),M.value=setTimeout(()=>{$(!1)},1500)},o=async()=>{if(!f.value.trim()&&v.value.length===0||s.isGenerating)return;M.value&&clearTimeout(M.value),$(!1);const y=f.value,r=v.value.length>0?[...v.value]:[];f.value="",r.length>0&&s.currentModel!==S.VISION_MODEL&&s.setModel(S.VISION_MODEL),r.length>0?(await s.sendMessage(y,r),v.value=[]):await s.sendMessage(y)},e=async(y,r)=>{s.editMessage(y,r);const E=s.messages.findIndex(T=>T.id===y);E!==-1&&E<s.messages.length-1&&(s.messages=s.messages.slice(0,E+1),await s.sendMessage(r))},l=async()=>{const y=[...s.messages].reverse().find(r=>r.role==="user");if(y){const r=s.messages.findLastIndex(E=>E.role==="assistant");r!==-1&&s.messages.splice(r,1),await s.sendMessage(y.content,y.attachments)}},p=y=>{console.log("Image added:",y.name)},L=y=>{console.error("Image upload error:",y)};return Q({title:"Chat - HIKEathon 2025"}),(y,r)=>{const E=ve,T=_e,N=Ae;return i(),d("div",Le,[g(c)?.isSupabaseAvailable?_("",!0):(i(),d("div",Se," ⚠️ Real-time features unavailable. Working in offline mode. ")),t("div",De,[t("div",Pe,[t("div",Fe,[U(t("select",{"onUpdate:modelValue":r[0]||(r[0]=x=>m.value=x),onChange:r[1]||(r[1]=x=>g(s).setModel(m.value)),class:"px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700",disabled:g(s).modelsLoading},[g(s).modelsLoading?(i(),d("option",Be,"Loading models...")):g(s).availableModels.length===0?(i(),d("option",Ue,"No models available")):_("",!0),(i(!0),d(D,null,P(g(s).availableModels,x=>(i(),d("option",{key:x.id,value:x.id},I(x.name),9,Oe))),128))],40,Te),[[K,m.value]]),t("div",ze,I(g(s).contextTokens)+" / "+I(g(s).currentModelInfo?.contextLength||0)+" tokens ",1)]),t("button",{onClick:r[2]||(r[2]=x=>g(s).clearMessages()),class:"px-3 py-2 text-sm bg-red-600 hover:bg-red-700 text-white rounded-lg"}," Clear ")])]),t("div",Re,[(i(!0),d(D,null,P(g(s).messages,x=>(i(),d("div",{key:x.id,class:"mb-4"},[C(E,{message:x,onEdit:e,onDelete:Ye=>g(s).deleteMessage(x.id),onRegenerate:l},null,8,["message","onDelete"])]))),128)),n.value.length>0?(i(),d("div",Ve,[r[6]||(r[6]=t("div",{class:"flex gap-1"},[t("div",{class:"w-2 h-2 bg-gray-400 rounded-full animate-pulse"}),t("div",{class:"w-2 h-2 bg-gray-400 rounded-full animate-pulse",style:{"animation-delay":"0.2s"}}),t("div",{class:"w-2 h-2 bg-gray-400 rounded-full animate-pulse",style:{"animation-delay":"0.4s"}})],-1)),t("span",je,I(n.value.join(", "))+" "+I(n.value.length===1?"is":"are")+" typing... ",1)])):_("",!0),g(s).isGenerating&&!g(s).currentStreamingMessage?.content?(i(),d("div",Ne,[...r[7]||(r[7]=[X('<div class="flex gap-1"><div class="w-2 h-2 bg-blue-600 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style="animation-delay:0.1s;"></div><div class="w-2 h-2 bg-blue-600 rounded-full animate-bounce" style="animation-delay:0.2s;"></div></div><span class="text-sm">Generating...</span>',2)])])):_("",!0)]),t("div",Ge,[C(T,{images:g(v),onRemove:g(b)},null,8,["images","onRemove"]),t("div",We,[U(t("textarea",{"onUpdate:modelValue":r[3]||(r[3]=x=>f.value=x),onKeydown:Y(Z(o,["exact"]),["enter"]),onInput:a,onPaste:r[4]||(r[4]=(...x)=>g(h)&&g(h)(...x)),placeholder:"Type your message... (paste images with Ctrl+V)",disabled:g(s).isGenerating,rows:"2",class:"flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 resize-none"},null,40,He),[[V,f.value]]),t("div",Ke,[C(N,{onImageAdded:p,onError:L}),g(s).isGenerating?(i(),d("button",{key:1,onClick:r[5]||(r[5]=x=>g(s).stopGeneration()),class:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg"}," Stop ")):(i(),d("button",{key:0,onClick:o,disabled:!f.value.trim()&&g(v).length===0,class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-50"}," Send ",8,Xe))])])])])}}});export{nt as default};
