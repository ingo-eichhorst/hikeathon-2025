import{y as I,b as z,O as c,U as r,Z as C,$ as w,a2 as M,z as o,F as k,_,V as n,Y as S,a0 as $,a4 as L,a5 as H,H as u}from"./lyzmDKnL.js";import{d as D,u as U}from"#entry";import"./r888hXRh.js";import{u as f}from"./LRrg9f3x.js";import{u as G}from"./BJ9MKNdY.js";import"./wtOtceyD.js";const v=[{id:"black-forest-labs/FLUX.1-schnell",name:"FLUX.1 Schnell",description:"Fastest image generation, good quality",maxPromptLength:1e3,sizes:["1024x1024"],provider:"Black Forest Labs"},{id:"stabilityai/stable-diffusion-xl-base-1.0",name:"Stable Diffusion XL",description:"High quality, versatile",maxPromptLength:1e3,sizes:["1024x1024"],provider:"Stability AI"}],V=D("images",{state:()=>({history:[],currentModel:"black-forest-labs/FLUX.1-schnell",currentSize:"1024x1024",isGenerating:!1,currentPrompt:"",error:null,galleryView:"grid",maxHistory:20}),getters:{currentModelInfo:s=>v.find(e=>e.id===s.currentModel),availableSizes:s=>v.find(i=>i.id===s.currentModel)?.sizes||["1024x1024"],sortedHistory:s=>[...s.history].sort((e,i)=>i.timestamp.getTime()-e.timestamp.getTime()),todayImages:s=>{const e=new Date;return e.setHours(0,0,0,0),s.history.filter(i=>new Date(i.timestamp)>=e)}},actions:{async generateImage(s){if(!(!s.trim()||this.isGenerating)){this.isGenerating=!0,this.error=null,this.currentPrompt=s;try{const{$supabase:e}=U(),i=await fetch(`${e.functions.url}/proxy-images`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.supabaseKey}`,apikey:e.supabaseKey},body:JSON.stringify({model:this.currentModel,prompt:s,size:this.currentSize,n:1})});if(!i.ok){const t=await i.text();throw new Error(`Failed to generate image: ${t}`)}const d=(await i.json()).data?.[0];if(!d)throw new Error("No image data in response");let y;if(d.b64_json){const t=d.b64_json,g=atob(t),m=new Array(g.length);for(let x=0;x<g.length;x++)m[x]=g.charCodeAt(x);const b=new Uint8Array(m),h=new Blob([b],{type:"image/png"});y=URL.createObjectURL(h)}else if(d.url)y=d.url;else throw new Error("No image data (b64_json or url) in response");const p={id:crypto.randomUUID(),prompt:s,model:this.currentModel,url:y,timestamp:new Date,size:this.currentSize,revised_prompt:d.revised_prompt};return this.addToHistory(p),f().playSound("success"),p}catch(e){throw console.error("Image generation error:",e),this.error=e.message,f().playSound("error"),e}finally{this.isGenerating=!1}}},addToHistory(s){this.history.unshift(s),this.history.length>this.maxHistory&&(this.history=this.history.slice(0,this.maxHistory))},removeFromHistory(s){const e=this.history.findIndex(i=>i.id===s);e!==-1&&this.history.splice(e,1)},clearHistory(){this.history=[]},setModel(s){this.currentModel=s;const e=v.find(i=>i.id===s);e&&!e.sizes.includes(this.currentSize)&&(this.currentSize=e.sizes[0])},setSize(s){this.currentSize=s},setGalleryView(s){this.galleryView=s},async downloadImage(s){try{const i=await(await fetch(s.url)).blob(),l=URL.createObjectURL(i),d=document.createElement("a");d.href=l,d.download=`hikeathon-image-${s.id.substring(0,8)}.png`,d.click(),URL.revokeObjectURL(l),f().playSound("success")}catch(e){console.error("Failed to download image:",e),this.error="Failed to download image"}},copyPrompt(s){navigator.clipboard&&(navigator.clipboard.writeText(s),f().playSound("success"))}},persist:{paths:["history","currentModel","currentSize","galleryView","maxHistory"]}}),F={class:"h-full flex flex-col"},j={class:"p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},P={class:"flex items-center justify-between"},T={class:"flex items-center gap-4"},E=["value"],A=["value"],N={class:"text-sm text-gray-600 dark:text-gray-400"},O={class:"flex gap-2"},B={class:"flex-1 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-900"},K={key:0,class:"mb-4 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded-lg"},R=["src","alt","onClick"],X={class:"p-4"},q={class:"text-sm text-gray-700 dark:text-gray-300 mb-2 line-clamp-2"},J={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},Y={class:"flex gap-2 mt-3"},Z=["onClick"],Q=["onClick"],W=["onClick"],ee={key:2,class:"text-center text-gray-500 dark:text-gray-400 mt-12"},te={class:"p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},re={class:"flex gap-2"},se=["onKeydown","disabled","maxlength"],oe=["disabled"],ae={class:"text-xs text-gray-500 dark:text-gray-400 mt-2"},ie=["src","alt"],ne={class:"p-4"},le={class:"text-gray-700 dark:text-gray-300 mb-2"},de={class:"text-sm text-gray-500 dark:text-gray-400"},be=I({__name:"images",setup(s){const e=V(),i=z(""),l=z(null),d=async()=>{if(!(!i.value.trim()||e.isGenerating))try{await e.generateImage(i.value),i.value=""}catch(p){console.error("Failed to generate image:",p)}},y=p=>{const a=new Date(p),g=new Date().getTime()-a.getTime(),m=Math.floor(g/6e4),b=Math.floor(g/36e5),h=Math.floor(g/864e5);return m<1?"Just now":m<60?`${m}m ago`:b<24?`${b}h ago`:h<7?`${h}d ago`:a.toLocaleDateString()};return G({title:"Images - HIKEathon 2025"}),(p,a)=>(u(),c("div",F,[r("div",j,[r("div",P,[r("div",T,[w(r("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>o(e).currentModel=t),onChange:a[1]||(a[1]=t=>o(e).setModel(o(e).currentModel)),class:"px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},[(u(!0),c(k,null,_(o(v),t=>(u(),c("option",{key:t.id,value:t.id},n(t.name),9,E))),128))],544),[[M,o(e).currentModel]]),w(r("select",{"onUpdate:modelValue":a[2]||(a[2]=t=>o(e).currentSize=t),onChange:a[3]||(a[3]=t=>o(e).setSize(o(e).currentSize)),class:"px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},[(u(!0),c(k,null,_(o(e).availableSizes,t=>(u(),c("option",{key:t,value:t},n(t),9,A))),128))],544),[[M,o(e).currentSize]]),r("div",N,n(o(e).currentModelInfo?.provider),1)]),r("div",O,[r("button",{onClick:a[4]||(a[4]=t=>o(e).setGalleryView("grid")),class:S(["px-3 py-2 text-sm rounded-lg",o(e).galleryView==="grid"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700"])}," Grid ",2),r("button",{onClick:a[5]||(a[5]=t=>o(e).setGalleryView("list")),class:S(["px-3 py-2 text-sm rounded-lg",o(e).galleryView==="list"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700"])}," List ",2),r("button",{onClick:a[6]||(a[6]=t=>o(e).clearHistory()),class:"px-3 py-2 text-sm bg-red-600 hover:bg-red-700 text-white rounded-lg"}," Clear History ")])])]),r("div",B,[o(e).error?(u(),c("div",K,n(o(e).error),1)):C("",!0),o(e).sortedHistory.length>0?(u(),c("div",{key:1,class:S(["mb-4",o(e).galleryView==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-4"])},[(u(!0),c(k,null,_(o(e).sortedHistory,t=>(u(),c("div",{key:t.id,class:"bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-lg"},[r("img",{src:t.url,alt:t.prompt,class:"w-full h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:g=>l.value=t},null,8,R),r("div",X,[r("p",q,n(t.prompt),1),r("div",J,[r("span",null,n(t.model)+" • "+n(t.size),1),r("span",null,n(y(t.timestamp)),1)]),r("div",Y,[r("button",{onClick:g=>o(e).downloadImage(t),class:"flex-1 px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded"}," Download ",8,Z),r("button",{onClick:g=>o(e).copyPrompt(t.prompt),class:"flex-1 px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded"}," Copy Prompt ",8,Q),r("button",{onClick:g=>o(e).removeFromHistory(t.id),class:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 text-white rounded"}," Delete ",8,W)])])]))),128))],2)):(u(),c("div",ee,[...a[11]||(a[11]=[r("p",{class:"text-lg mb-2"},"No images generated yet",-1),r("p",{class:"text-sm"},"Enter a prompt below to generate your first image",-1)])]))]),r("div",te,[r("div",re,[w(r("textarea",{"onUpdate:modelValue":a[7]||(a[7]=t=>i.value=t),onKeydown:L(H(d,["exact","prevent"]),["enter"]),placeholder:"Describe the image you want to generate...",disabled:o(e).isGenerating,rows:"2",class:"flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 resize-none",maxlength:o(e).currentModelInfo?.maxPromptLength||1e3},null,40,se),[[$,i.value]]),r("button",{onClick:d,disabled:!i.value.trim()||o(e).isGenerating,class:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"},n(o(e).isGenerating?"Generating...":"Generate"),9,oe)]),r("div",ae,n(i.value.length)+" / "+n(o(e).currentModelInfo?.maxPromptLength||1e3)+" characters ",1)]),l.value?(u(),c("div",{key:0,onClick:a[10]||(a[10]=t=>l.value=null),class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"},[r("div",{onClick:a[9]||(a[9]=H(()=>{},["stop"])),class:"bg-white dark:bg-gray-800 rounded-lg max-w-4xl max-h-[90vh] overflow-auto"},[r("img",{src:l.value.url,alt:l.value.prompt,class:"w-full h-auto"},null,8,ie),r("div",ne,[r("p",le,n(l.value.prompt),1),r("div",de,n(l.value.model)+" • "+n(l.value.size)+" • "+n(y(l.value.timestamp)),1),r("button",{onClick:a[8]||(a[8]=t=>l.value=null),class:"mt-4 px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded w-full"}," Close ")])])])):C("",!0)]))}});export{be as default};
