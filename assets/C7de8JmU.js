import{l as Q,d as i,q as ee,m as N,$ as te,O as l,U as t,X as g,W as $,V as r,Y as y,_ as se,a0 as k,a3 as S,a5 as ae,a1 as le,F as M,Z as F,u as _,H as o}from"./BXsWsSdj.js";import{u as oe,a as re,b as ne}from"#entry";import{u as de}from"./B4-yCsMx.js";import{u as ue}from"./f0siJDNu.js";import"./CdQP9W9V.js";import"./Bm9-FWAX.js";const ie={class:"space-y-6"},ce={class:"card"},ge={key:0,class:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},ve={class:"space-y-1 text-sm"},be={class:"flex items-center gap-2"},me={class:"flex gap-2"},ye=["disabled"],pe=["disabled"],xe=["disabled"],fe={class:"card"},we={class:"space-y-4"},ke=["disabled"],he={class:"card"},Ce={key:0,class:"text-gray-500"},Se={key:1,class:"space-y-2"},_e={class:"font-medium"},Te={class:"ml-2 text-sm text-gray-500"},De={class:"flex items-center gap-2"},Be={class:"text-xs text-gray-500"},Ae={class:"card"},Me={class:"space-y-4"},Fe={class:"flex items-center gap-2"},Ue={class:"capitalize"},Ve={key:0,class:"text-sm text-yellow-600 dark:text-yellow-400"},Ie={class:"mt-4 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg"},qe={class:"flex gap-2"},Ne=["disabled"],$e={class:"mt-4"},Ee={key:0,class:"text-sm text-gray-500"},Re={key:1,class:"space-y-1"},Le={class:"card"},Oe={key:0,class:"text-gray-500"},He={key:1,class:"space-y-2"},je={class:"flex items-start justify-between"},ze={class:"flex-1"},Pe={class:"mt-1 flex items-center gap-2 text-xs text-gray-500"},We={key:0},et=Q({__name:"admin",setup(Ge){const E=ne(),R=oe(),{$supabase:p}=re(),{sendBroadcast:U,broadcasts:T,presence:L,connectionState:C,isSupabaseAvailable:D}=de();R.isAdmin()||E.push("/");const x=i(""),B=i("info"),h=i(!1),v=i(null),n=i(null),c=i(!1),d=i(null),u=i({title:"",deadline:"",active:!0}),b=i(""),m=i(null),f=i([]);ee(T,s=>{const e=s[0];e&&e.from==="test"&&(f.value.unshift(`${e.message} (${new Date(e.timestamp).toLocaleTimeString()})`),f.value.length>5&&(f.value=f.value.slice(0,5)))});const V=N(()=>Array.from(L.value.values())),I=N(()=>T.value.slice(0,10)),O=async()=>{if(b.value.trim()){m.value=null;try{console.log("Sending test broadcast:",b.value),console.log("Connection state:",C.value),console.log("Supabase available:",D.value),await U(b.value,"info","test"),console.log("Broadcast sent, current broadcasts:",T.value),m.value={success:!0,message:`✓ Test broadcast sent successfully! Connection: ${C.value}`},b.value="",setTimeout(()=>{m.value=null},3e3)}catch(s){console.error("Test broadcast error:",s),m.value={success:!1,message:`✗ Failed: ${s instanceof Error?s.message:"Unknown error"}`}}}},H=async()=>{if(!(!x.value.trim()||h.value)){h.value=!0,v.value=null;try{await U(x.value,B.value,"Admin"),v.value={type:"success",message:"Broadcast sent and saved to database successfully!"},x.value="",setTimeout(()=>{v.value=null},3e3)}catch(s){console.error("Error sending broadcast:",s),v.value={type:"error",message:"Failed to send broadcast"}}finally{h.value=!1}}},q=s=>{switch(s){case"success":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"}},j=s=>{switch(s){case"success":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"warning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"error":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"}},z=s=>s==="idle"?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",P=s=>{switch(s){case"connected":return"bg-green-500 animate-pulse";case"connecting":return"bg-yellow-500 animate-pulse";default:return"bg-red-500"}},W=s=>new Date(s).toLocaleTimeString(),G=s=>{const e=new Date(s),w=new Date().getTime()-e.getTime();return w<6e4?"Just now":w<36e5?`${Math.floor(w/6e4)}m ago`:`${Math.floor(w/36e5)}h ago`},J=s=>new Date(s).toLocaleString("en-US",{dateStyle:"full",timeStyle:"short"}),A=async()=>{try{const{data:s,error:e}=await p.from("countdowns").select("*").eq("active",!0).order("created_at",{ascending:!1}).limit(1).single();if(e&&e.code!=="PGRST116")throw e;s&&(n.value=s,u.value={title:s.title,deadline:new Date(s.deadline).toISOString().slice(0,16),active:s.active})}catch(s){console.error("Failed to load countdown:",s)}},K=async()=>{c.value=!0,d.value=null;try{const s={title:u.value.title,deadline:new Date(u.value.deadline).toISOString(),active:u.value.active};if(n.value){const{error:e}=await p.from("countdowns").update(s).eq("id",n.value.id);if(e)throw e;d.value={type:"success",text:"Countdown updated successfully!"}}else{await p.from("countdowns").update({active:!1}).eq("active",!0);const{error:e}=await p.from("countdowns").insert([s]);if(e)throw e;d.value={type:"success",text:"Countdown created successfully!"}}await A(),setTimeout(()=>{d.value=null},3e3)}catch(s){console.error("Failed to save countdown:",s),d.value={type:"error",text:s.message||"Failed to save countdown"}}finally{c.value=!1}},X=async()=>{if(n.value){c.value=!0,d.value=null;try{const{error:s}=await p.from("countdowns").update({active:!1}).eq("id",n.value.id);if(s)throw s;d.value={type:"success",text:"Countdown deactivated successfully!"},await A()}catch(s){console.error("Failed to deactivate countdown:",s),d.value={type:"error",text:s.message||"Failed to deactivate countdown"}}finally{c.value=!1}}},Y=async()=>{if(n.value&&confirm("Are you sure you want to delete this countdown?")){c.value=!0,d.value=null;try{const{error:s}=await p.from("countdowns").delete().eq("id",n.value.id);if(s)throw s;d.value={type:"success",text:"Countdown deleted successfully!"},n.value=null,u.value={title:"",deadline:"",active:!0}}catch(s){console.error("Failed to delete countdown:",s),d.value={type:"error",text:s.message||"Failed to delete countdown"}}finally{c.value=!1}}};return te(()=>{A()}),ue({title:"Admin - HIKEathon 2025"}),(s,e)=>(o(),l("div",ie,[e[25]||(e[25]=t("h1",{class:"text-3xl font-bold"},"Admin Panel",-1)),t("div",ce,[e[14]||(e[14]=t("h2",{class:"text-xl font-semibold mb-4"},"Countdown Management",-1)),n.value?(o(),l("div",ge,[e[9]||(e[9]=t("h3",{class:"font-semibold mb-2"},"Current Active Countdown",-1)),t("div",ve,[t("p",null,[e[6]||(e[6]=t("strong",null,"Title:",-1)),$(" "+r(n.value.title),1)]),t("p",null,[e[7]||(e[7]=t("strong",null,"Deadline:",-1)),$(" "+r(J(n.value.deadline)),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"Status:",-1)),t("span",{class:y(["px-2 py-1 rounded text-xs",n.value.active?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"])},r(n.value.active?"Active":"Inactive"),3)])])])):g("",!0),t("form",{onSubmit:se(K,["prevent"]),class:"space-y-4"},[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium mb-2"}," Title / Deadline Text ",-1)),k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.title=a),type:"text",placeholder:"e.g., Submission Deadline, Event Starts In...",required:"",class:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},null,512),[[S,u.value.title]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium mb-2"}," Deadline Date & Time ",-1)),k(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.deadline=a),type:"datetime-local",required:"",class:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},null,512),[[S,u.value.deadline]]),e[12]||(e[12]=t("p",{class:"text-xs text-gray-500 mt-1"}," Countdown will be visible until 5 minutes after this deadline ",-1))]),t("div",be,[k(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.active=a),type:"checkbox",id:"countdown-active-checkbox",class:"w-4 h-4 rounded border-gray-300 dark:border-gray-600"},null,512),[[ae,u.value.active]]),e[13]||(e[13]=t("label",{for:"countdown-active-checkbox",class:"text-sm font-medium"}," Active (visible to users) ",-1))]),t("div",me,[t("button",{type:"submit",disabled:c.value,class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-50 text-sm"},r(c.value?"Saving...":n.value?"Update":"Create"),9,ye),n.value?(o(),l("button",{key:0,type:"button",onClick:X,disabled:c.value,class:"px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg disabled:opacity-50 text-sm"}," Deactivate ",8,pe)):g("",!0),n.value?(o(),l("button",{key:1,type:"button",onClick:Y,disabled:c.value,class:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg disabled:opacity-50 text-sm"}," Delete ",8,xe)):g("",!0)]),d.value?(o(),l("div",{key:0,class:y(["p-3 rounded-lg text-sm",q(d.value.type)])},r(d.value.text),3)):g("",!0)],32)]),t("div",fe,[e[18]||(e[18]=t("h2",{class:"text-xl font-semibold mb-4"},"Send Broadcast",-1)),t("div",we,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium mb-2"},"Message",-1)),k(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>x.value=a),rows:"3",placeholder:"Enter broadcast message...",class:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},null,512),[[S,x.value]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium mb-2"},"Type",-1)),k(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>B.value=a),class:"px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},[...e[16]||(e[16]=[t("option",{value:"info"},"Info",-1),t("option",{value:"success"},"Success",-1),t("option",{value:"warning"},"Warning",-1),t("option",{value:"error"},"Error",-1)])],512),[[le,B.value]])]),t("button",{onClick:H,disabled:!x.value.trim()||h.value,"data-testid":"send-broadcast",class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg disabled:opacity-50"},r(h.value?"Sending...":"Send Broadcast"),9,ke),v.value?(o(),l("div",{key:0,class:y(["p-3 rounded-lg",q(v.value.type)])},r(v.value.message),3)):g("",!0)])]),t("div",he,[e[19]||(e[19]=t("h2",{class:"text-xl font-semibold mb-4"},"Active Teams",-1)),V.value.length===0?(o(),l("div",Ce," No teams currently online ")):(o(),l("div",Se,[(o(!0),l(M,null,F(V.value,a=>(o(),l("div",{key:a.teamId,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg"},[t("div",null,[t("span",_e,r(a.teamName),1),t("span",Te," (ID: "+r(a.teamId)+") ",1)]),t("div",De,[t("span",{class:y(["text-xs px-2 py-1 rounded-full",z(a.status)])},r(a.status||"active"),3),t("span",Be,r(G(a.onlineAt)),1)])]))),128))]))]),t("div",Ae,[e[23]||(e[23]=t("h2",{class:"text-xl font-semibold mb-4"},"Connection Status & Broadcast Tester",-1)),t("div",Me,[t("div",Fe,[t("div",{class:y(["w-3 h-3 rounded-full",P(_(C))])},null,2),t("span",Ue,r(_(C)),1),_(D)?g("",!0):(o(),l("span",Ve," (Realtime unavailable) "))]),t("div",Ie,[e[20]||(e[20]=t("h3",{class:"font-medium mb-2"},"Test Broadcast Channel",-1)),e[21]||(e[21]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mb-3"}," Send a test message to verify broadcast functionality ",-1)),t("div",qe,[k(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>b.value=a),type:"text",placeholder:"Test message...",class:"flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},null,512),[[S,b.value]]),t("button",{onClick:O,disabled:!b.value.trim()||!_(D),class:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg disabled:opacity-50"}," Test ",8,Ne)]),m.value?(o(),l("div",{key:0,class:y(["mt-3 p-2 rounded text-sm",m.value.success?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200"])},r(m.value.message),3)):g("",!0)]),t("div",$e,[e[22]||(e[22]=t("h3",{class:"font-medium mb-2"},"Received Test Messages",-1)),f.value.length===0?(o(),l("div",Ee," No test messages received yet ")):(o(),l("div",Re,[(o(!0),l(M,null,F(f.value,(a,w)=>(o(),l("div",{key:w,class:"text-sm p-2 bg-blue-50 dark:bg-blue-900 rounded"},r(a),1))),128))]))])])]),t("div",Le,[e[24]||(e[24]=t("h2",{class:"text-xl font-semibold mb-4"},"Recent Broadcasts",-1)),I.value.length===0?(o(),l("div",Oe," No broadcasts sent yet ")):(o(),l("div",He,[(o(!0),l(M,null,F(I.value,a=>(o(),l("div",{key:a.id,class:"p-3 rounded-lg border border-gray-200 dark:border-gray-700"},[t("div",je,[t("div",ze,[t("p",null,r(a.message),1),t("div",Pe,[a.from?(o(),l("span",We,"From: "+r(a.from),1)):g("",!0),t("span",null,r(W(a.timestamp)),1),t("span",{class:y(["px-2 py-0.5 rounded-full text-xs",j(a.type)])},r(a.type),3)])])])]))),128))]))])]))}});export{et as default};
