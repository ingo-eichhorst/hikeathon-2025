import{l as z,d as _,O as c,U as s,X as S,a0 as f,a1 as M,u as a,F as x,Z as v,V as l,a3 as I,a4 as C,_ as D,H as g}from"./BXsWsSdj.js";import{d as H,a as $}from"#entry";import"./DOa35t5X.js";import{u as y}from"./BNgioekW.js";import{u as L}from"./f0siJDNu.js";import"./CdQP9W9V.js";const h=[{id:"black-forest-labs/FLUX.1-schnell",name:"FLUX.1 Schnell",description:"Fastest image generation, good quality",maxPromptLength:1e3,sizes:["1024x1024"],provider:"Black Forest Labs"},{id:"stabilityai/stable-diffusion-xl-base-1.0",name:"Stable Diffusion XL",description:"High quality, versatile",maxPromptLength:1e3,sizes:["1024x1024"],provider:"Stability AI"}],U=H("images",{state:()=>({history:[],currentModel:"black-forest-labs/FLUX.1-schnell",currentSize:"1024x1024",isGenerating:!1,currentPrompt:"",error:null,galleryView:"grid",maxHistory:20}),getters:{currentModelInfo:t=>h.find(e=>e.id===t.currentModel),availableSizes:t=>h.find(o=>o.id===t.currentModel)?.sizes||["1024x1024"],sortedHistory:t=>[...t.history].sort((e,o)=>{const n=e.timestamp instanceof Date?e.timestamp:new Date(e.timestamp);return(o.timestamp instanceof Date?o.timestamp:new Date(o.timestamp)).getTime()-n.getTime()}),todayImages:t=>{const e=new Date;return e.setHours(0,0,0,0),t.history.filter(o=>new Date(o.timestamp)>=e)}},actions:{async generateImage(t){if(!(!t.trim()||this.isGenerating)){this.isGenerating=!0,this.error=null,this.currentPrompt=t;try{const{$supabase:e}=$(),o=await fetch(`${e.functions.url}/proxy-images`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.supabaseKey}`,apikey:e.supabaseKey},body:JSON.stringify({model:this.currentModel,prompt:t,size:this.currentSize,n:1})});if(!o.ok){const r=await o.text();throw new Error(`Failed to generate image: ${r}`)}const d=(await o.json()).data?.[0];if(!d)throw new Error("No image data in response");let u;if(d.b64_json)u=`data:image/png;base64,${d.b64_json}`;else if(d.url)u=d.url;else throw new Error("No image data (b64_json or url) in response");const m={id:crypto.randomUUID(),prompt:t,model:this.currentModel,url:u,timestamp:new Date,size:this.currentSize,revised_prompt:d.revised_prompt};return this.addToHistory(m),y().playSound("success"),m}catch(e){throw console.error("Image generation error:",e),this.error=e.message,y().playSound("error"),e}finally{this.isGenerating=!1}}},addToHistory(t){this.history.unshift(t),this.history.length>this.maxHistory&&(this.history=this.history.slice(0,this.maxHistory))},removeFromHistory(t){const e=this.history.findIndex(o=>o.id===t);e!==-1&&this.history.splice(e,1)},clearHistory(){this.history=[]},setModel(t){this.currentModel=t;const e=h.find(o=>o.id===t);e&&!e.sizes.includes(this.currentSize)&&(this.currentSize=e.sizes[0])},setSize(t){this.currentSize=t},setGalleryView(t){this.galleryView=t},async downloadImage(t){try{const o=await(await fetch(t.url)).blob(),n=URL.createObjectURL(o),d=document.createElement("a");d.href=n,d.download=`hikeathon-image-${t.id.substring(0,8)}.png`,d.click(),URL.revokeObjectURL(n),y().playSound("success")}catch(e){console.error("Failed to download image:",e),this.error="Failed to download image"}},copyPrompt(t){navigator.clipboard&&(navigator.clipboard.writeText(t),y().playSound("success"))}},persist:{paths:["history","currentModel","currentSize","galleryView","maxHistory"],hydrate:t=>{t.history&&Array.isArray(t.history)&&(t.history=t.history.map(e=>({...e,timestamp:e.timestamp instanceof Date?e.timestamp:new Date(e.timestamp)})))}}}),F={class:"h-full flex flex-col"},T={class:"p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},G={class:"flex items-center justify-between"},j={class:"flex items-center gap-4"},P=["value"],V=["value"],E={class:"text-sm text-gray-600 dark:text-gray-400"},N={class:"flex-1 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-900"},A={key:0,class:"mb-4 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded-lg"},K={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4"},O=["src","alt","onClick"],B={class:"p-4"},X={class:"text-sm text-gray-700 dark:text-gray-300 mb-2 line-clamp-2"},R={class:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400"},q={class:"flex gap-2 mt-3"},J=["onClick"],Z=["onClick"],Q=["onClick"],W={key:2,class:"text-center text-gray-500 dark:text-gray-400 mt-12"},Y={class:"p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},ee={class:"flex gap-2"},te=["onKeydown","disabled","maxlength"],re=["disabled"],se={class:"text-xs text-gray-500 dark:text-gray-400 mt-2"},oe=["src","alt"],ae={class:"p-4"},ie={class:"text-gray-700 dark:text-gray-300 mb-2"},ne={class:"text-sm text-gray-500 dark:text-gray-400"},pe=z({__name:"images",setup(t){const e=U(),o=_(""),n=_(null),d=async()=>{if(!(!o.value.trim()||e.isGenerating))try{await e.generateImage(o.value),o.value=""}catch(m){console.error("Failed to generate image:",m)}},u=m=>{const i=new Date(m),p=new Date().getTime()-i.getTime(),b=Math.floor(p/6e4),w=Math.floor(p/36e5),k=Math.floor(p/864e5);return b<1?"Just now":b<60?`${b}m ago`:w<24?`${w}h ago`:k<7?`${k}d ago`:i.toLocaleDateString()};return L({title:"Images - HIKEathon 2025"}),(m,i)=>(g(),c("div",F,[s("div",T,[s("div",G,[s("div",j,[f(s("select",{"onUpdate:modelValue":i[0]||(i[0]=r=>a(e).currentModel=r),onChange:i[1]||(i[1]=r=>a(e).setModel(a(e).currentModel)),class:"px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},[(g(!0),c(x,null,v(a(h),r=>(g(),c("option",{key:r.id,value:r.id},l(r.name),9,P))),128))],544),[[M,a(e).currentModel]]),f(s("select",{"onUpdate:modelValue":i[2]||(i[2]=r=>a(e).currentSize=r),onChange:i[3]||(i[3]=r=>a(e).setSize(a(e).currentSize)),class:"px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700"},[(g(!0),c(x,null,v(a(e).availableSizes,r=>(g(),c("option",{key:r,value:r},l(r),9,V))),128))],544),[[M,a(e).currentSize]]),s("div",E,l(a(e).currentModelInfo?.provider),1)])])]),s("div",N,[a(e).error?(g(),c("div",A,l(a(e).error),1)):S("",!0),a(e).sortedHistory.length>0?(g(),c("div",K,[(g(!0),c(x,null,v(a(e).sortedHistory,r=>(g(),c("div",{key:r.id,class:"bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-lg"},[s("img",{src:r.url,alt:r.prompt,class:"w-full h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:p=>n.value=r},null,8,O),s("div",B,[s("p",X,l(r.prompt),1),s("div",R,[s("span",null,l(r.model)+" • "+l(r.size),1),s("span",null,l(u(r.timestamp)),1)]),s("div",q,[s("button",{onClick:p=>a(e).downloadImage(r),class:"flex-1 px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded"}," Download ",8,J),s("button",{onClick:p=>a(e).copyPrompt(r.prompt),class:"flex-1 px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded"}," Copy Prompt ",8,Z),s("button",{onClick:p=>a(e).removeFromHistory(r.id),class:"px-3 py-1 text-sm bg-red-600 hover:bg-red-700 text-white rounded"}," Delete ",8,Q)])])]))),128))])):(g(),c("div",W,[...i[8]||(i[8]=[s("p",{class:"text-lg mb-2"},"No images generated yet",-1),s("p",{class:"text-sm"},"Enter a prompt below to generate your first image",-1)])]))]),s("div",Y,[s("div",ee,[f(s("textarea",{"onUpdate:modelValue":i[4]||(i[4]=r=>o.value=r),onKeydown:C(D(d,["exact","prevent"]),["enter"]),placeholder:"Describe the image you want to generate...",disabled:a(e).isGenerating,rows:"2",class:"flex-1 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 resize-none",maxlength:a(e).currentModelInfo?.maxPromptLength||1e3},null,40,te),[[I,o.value]]),s("button",{onClick:d,disabled:!o.value.trim()||a(e).isGenerating,class:"px-4 py-2 bg-primary-500 hover:bg-primary-600 text-dark-900 rounded-lg disabled:opacity-50 font-semibold uppercase"},l(a(e).isGenerating?"Generating...":"Generate"),9,re)]),s("div",se,l(o.value.length)+" / "+l(a(e).currentModelInfo?.maxPromptLength||1e3)+" characters ",1)]),n.value?(g(),c("div",{key:0,onClick:i[7]||(i[7]=r=>n.value=null),class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"},[s("div",{onClick:i[6]||(i[6]=D(()=>{},["stop"])),class:"bg-white dark:bg-gray-800 rounded-lg max-w-4xl max-h-[90vh] overflow-auto"},[s("img",{src:n.value.url,alt:n.value.prompt,class:"w-full h-auto"},null,8,oe),s("div",ae,[s("p",ie,l(n.value.prompt),1),s("div",ne,l(n.value.model)+" • "+l(n.value.size)+" • "+l(u(n.value.timestamp)),1),s("button",{onClick:i[5]||(i[5]=r=>n.value=null),class:"mt-4 px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 rounded w-full"}," Close ")])])])):S("",!0)]))}});export{pe as default};
