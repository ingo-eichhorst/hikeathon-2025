import{d as a,a as i}from"#entry";const c=a("countdown",{state:()=>({currentCountdown:null,isLoading:!1,error:null}),getters:{isVisible:t=>{if(!t.currentCountdown||!t.currentCountdown.active)return!1;const n=new Date(t.currentCountdown.deadline).getTime(),e=Date.now(),o=300*1e3;return e<=n+o},timeRemaining:t=>{if(!t.currentCountdown)return{days:0,hours:0,minutes:0,seconds:0,total:0,isPast:!1};const n=new Date(t.currentCountdown.deadline).getTime(),e=Date.now(),o=n-e,s=o<0,r=Math.abs(o);return{days:Math.floor(r/(1e3*60*60*24)),hours:Math.floor(r%(1e3*60*60*24)/(1e3*60*60)),minutes:Math.floor(r%(1e3*60*60)/(1e3*60)),seconds:Math.floor(r%(1e3*60)/1e3),total:o,isPast:s}}},actions:{async fetchActiveCountdown(){this.isLoading=!0,this.error=null;try{const{$supabase:t}=i(),{data:n,error:e}=await t.from("countdowns").select("*").eq("active",!0).order("created_at",{ascending:!1}).limit(1).single();if(e&&e.code!=="PGRST116")throw e;this.currentCountdown=n||null}catch(t){console.error("Failed to fetch countdown:",t),this.error=t.message}finally{this.isLoading=!1}},setCountdown(t){this.currentCountdown=t},clearCountdown(){this.currentCountdown=null,this.error=null}},persist:!1});export{c as u};
